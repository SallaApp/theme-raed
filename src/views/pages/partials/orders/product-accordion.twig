{# Renders a collapsible summary for an order product with optional options list. #}
{% set accordionProduct = product %}
{% set accordion_id = accordion_id|default('accordion-' ~ accordionProduct.id) %}
{% set accordion_key = accordion_key|default(accordionProduct.id) %}
{% set accordion_size = accordion_size|default('sm') %}
{% set options = options|default(accordionProduct.options ?? []) %}
{% set collapsible_state = collapsible|default(options is not empty) %}
{% set productImage = product.image.url ?? product.image ?? ('images/placeholder.png' | asset) %}
{% set productImageAlt = product.image.alt ?? product.name %}

<salla-accordion
    key="{{ accordion_key }}"
    collapsed={false}
    bordered={true}
    collapsible="{{ collapsible_state ? 'true' : 'false' }}"
    id="{{ accordion_id }}"
    size="{{ accordion_size }}"
>
    <salla-accordion-head>
        <div class="py-3.5 flex items-center justify-between gap-3">
            <div class="min-w-0">
                <dd class="flex items-center gap-2 rtl:space-x-reverse text-xs text-gray-500 flex-wrap">
                    <div class="shrink-0 w-14 h-14 rounded-md border border-gray-100 overflow-hidden bg-white flex items-center justify-center">
                        <img src="{{ productImage }}" alt="{{ productImageAlt }}" class="w-full h-full object-cover">
                    </div>
                    <div class="grow min-w-0 flex flex-col gap-1">
                        <a href="{{ accordionProduct.url }}" class="block text-sm font-semibold text-gray-700 hover:text-primary truncate">
                            {{ accordionProduct.name }}
                        </a>
                        {% if product.is_on_sale and product.sale_price %}
                            <span class="font-semibold text-gray-900 text-sm">{{ product.sale_price|money }}</span>
                            {% if product.regular_price %}
                                <span class="line-through">{{ product.regular_price|money }}</span>
                            {% endif %}
                        {% else %}
                            <span class="font-semibold text-gray-900 text-sm">{{ product.price|money }}</span>
                        {% endif %}
                                  {% if accordionProduct.quantity %}
                            <span class="text-gray-400">Ã—{{ accordionProduct.quantity }}</span>
                        {% endif %}
                    </div>
                </dd>
            </div>
        
        </div>
    </salla-accordion-head>

    {% if options %}
        <salla-accordion-body>
            <div class="px-4 pb-3.5">
                <h3 class="mb-3 text-sm font-bold">{{ trans('pages.cart.item_options') }}</h3>
                <dl class="text-sm text-dark divide-y divide-border-color">
                    {% for option in options %}
                        <div class="py-2.5 center-between">
                            <dt class="mb-2 md:mb-0">
                                {{ option.name }}:
                            </dt>
                            <dd class="font-medium {{ option.is_image ? 'text-gray-900' : 'text-xs' }}">
                                {% if option.is_image %}
                                    <div class="flex rtl:space-x-reverse space-x-2.5">
                                        <a href="{{ option.value }}" target="_blank">
                                            <img class="h-6 w-6 object-cover rounded-md"
                                                 src="{{ option.value ?: 'images/placeholder.png' | asset }}"
                                                 alt="{{ option.name }}"/>
                                        </a>
                                    </div>
                                {% elseif option.color %}
                                    <span title="{{ option.value }}" class="inline-block h-6 w-6 rtl:mr-2 ltr:ml-2 rounded-full shadow" style="background-color: {{ option.color }}"></span>
                                {% elseif option.is_file %}
                                    <a href="{{ option.value }}" target="_blank" class="text-sm text-primary underline">{{ trans('pages.products.attachments') }}</a>
                                {% elseif option.is_color_picker %}
                                    <div class="flex w-fit border border-gray-100 rounded">
                                        <div class="flex-center ltr:border-r rtl:border-l border-gray-100 ltr:pr-1 rtl:pl-1">
                                            <span class="text-xs px-1">{{ option.value }}</span>
                                            <span class="inline-block h-4 rtl:mr-1 ltr:ml-1 rounded p-1 border border-gray-100 shadow" style="background-color: {{ option.value }};width: 1rem"></span>
                                        </div>
                                        <salla-button onclick="app.copyToClipboard(event)" shape="link" data-content="{{ option.value }}" class="pt-1 px-1">
                                            <i class="sicon-swap-stroke pointer-events-none text-sm text-gray-500"></i>
                                        </salla-button>
                                    </div>
                                {% elseif option.is_map %}
                                    <salla-map
                                        id="location_map"
                                        class="map_{{ option.id }}"
                                        zoom="15"
                                        readonly
                                        lat="{{ option.latitude }}"
                                        lng="{{ option.longitude }}"
                                    >
                                        <div slot="button">
                                            <button type="button" class="text-sm text-primary" onclick="document.querySelector('salla-map.map_{{ option.id }}').open()">
                                                {{ trans('pages.products.show_location') }}
                                            </button>
                                        </div>
                                    </salla-map>
                                {% else %}
                                    {{ option.value }}
                                {% endif %}
                            </dd>
                        </div>
                    {% endfor %}
                </dl>
            </div>
        </salla-accordion-body>
    {% endif %}
</salla-accordion>

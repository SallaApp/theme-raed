{# Renders a collapsible summary for an order product with optional options list. #}
{% set accordionProduct = product %}
{% set accordion_id = accordion_id|default('accordion-' ~ accordionProduct.id) %}
{% set accordion_key = accordion_key|default(accordionProduct.id) %}
{% set accordion_size = accordion_size|default('sm') %}
{% set options = options|default(accordionProduct.options ?? []) %}
{% set collapsible_state = collapsible|default(options is not empty) %}
{% set productImage = product.image.url ?? product.image ?? ('images/placeholder.png' | asset) %}
{% set productImageAlt = product.image.alt ?? product.name %}

<salla-accordion
    key="{{ accordion_key }}"
    collapsed={false}
    bordered={true}
    collapsible="{{ collapsible_state ? 'true' : 'false' }}"
    id="{{ accordion_id }}"
    size="{{ accordion_size }}"
>
    <salla-accordion-head>
        <div class="flex items-center justify-between gap-3">
            <div class="min-w-0">
                <dd class="flex items-center gap-2 rtl:space-x-reverse text-xs text-gray-500 flex-wrap">
                    <div class="shrink-0 w-14 h-14 rounded-md border border-gray-100 overflow-hidden bg-white flex items-center justify-center">
                        <img src="{{ productImage }}" alt="{{ productImageAlt }}" class="w-full h-full object-cover">
                    </div>
                    <div class="grow min-w-0 flex flex-col gap-1">
                        <a href="{{ accordionProduct.url }}" class="block text-sm font-semibold text-gray-700 hover:text-primary truncate">
                            {{ accordionProduct.name }}
                        </a>
                        {% if product.is_on_sale and product.sale_price %}
                            <span class="font-semibold text-gray-900 text-sm">{{ product.sale_price|money }}</span>
                            {% if product.regular_price %}
                                <span class="line-through">{{ product.regular_price|money }}</span>
                            {% endif %}
                        {% else %}
                            <span class="font-semibold text-gray-900 text-sm">{{ product.price|money }}</span>
                        {% endif %}
                                  {% if accordionProduct.quantity %}
                            <span class="text-gray-400">Ã—{{ accordionProduct.quantity }}</span>
                        {% endif %}
                    </div>
                </dd>
            </div>
        
        </div>
    </salla-accordion-head>

    {% if options %}
        <salla-accordion-body>
            {% include 'pages.partials.orders.item-options' with { options: options } %}
        </salla-accordion-body>
    {% endif %}
</salla-accordion>

{#
| Variable                             | Type          | Description                                  |
|--------------------------------------|---------------|----------------------------------------------|
| page                                 | Page          |                                              |
| page.title                           | string        |                                              |
| page.slug                            | string        |                                              |
| loyalty                              | Loyalty       |                                              |
| loyalty.name                         | string        |                                              |
| loyalty.description                  | string        |                                              |
| loyalty.image                        | string        |                                              |
| loyalty.promotion_title              | string        |                                              |
| loyalty.promotion_description        | string        |                                              |
| loyalty.points                       | Point[]       |                                              |
| loyalty.points[].name                | string        |                                              |
| loyalty.points[].description         | string        |                                              |
| loyalty.points[].type                | string        | share, rating, order, profile                |
| loyalty.points[].url                 | ?string       |                                              |
| loyalty.points[].points              | int           |                                              |
| loyalty.points[].icon                | string        |                                              |
| loyalty.points[].color               | string        |                                              |
| loyalty.prizes[]                     | PrizesGroup[] |                                              |
| loyalty.prizes[].title               | string        |                                              |
| loyalty.prizes[].type                | string        | free_product, coupon_discount, free_shipping |
| loyalty.prizes[].items[]             | Prize[]       |                                              |
| loyalty.prizes[].items[].id          | int           |                                              |
| loyalty.prizes[].items[].name        | string        |                                              |
| loyalty.prizes[].items[].description | string        |                                              |
| loyalty.prizes[].items[].image       | string        |                                              |
| loyalty.prizes[].items[].url         | ?string       |                                              |
| loyalty.prizes[].items[].cost_points | int           |                                              |
| user.loyalty_points                  | ?int          |                                              |
| user.is_profile_completed            | bool          |                                              |
#}
{% extends "layouts.master" %}

{% block content %}
    <div class="h-62 -mb-52 w-full bg-primary start-0 relative -z-1 bg-cover bg-no-repeat bg-center"
         style="background-image:url({{ loyalty.image }})">
        <div class="overlay h-full w-full bg-black opacity-50 absolute top-0 left-0"></div>
    </div>
    <div class="container space-y-16">

        {# Breadcrumbs #}
        <nav class="w-full py-5">{% component 'header.breadcrumbs' %}</nav>
        
        {# loyalty banner #}
        <div class="loyalty__banner">  
            <div class="loyalty__banner-inner">
                <i class="sicon-star2 star-anime opacity-0 text-amber-400 text-7xl"></i>
                <div class="loyalty__banner-content">
                    <div class="info">
                        <h1>{{ loyalty.name }}</h1>
                        <p>{{ loyalty.description }}</p>
                        {% if user.loyalty_points %}
                            <div class="loyalty-points">
                                {{ trans('pages.loyalty_program.you_have') }}
                                <span class="count-number count-anime" data-count="{{ user.loyalty_points }}"></span>
                                {{ trans("pages.loyalty_program.point") }}
                            </div>
                        {% endif %}
                    </div>

                    <salla-loyalty customer-points="{{ user.loyalty_points }}" class="btn-anime opacity-0">
                        <salla-button 
                          onclick="salla.event.dispatch('loyalty::open')"
                          slot="widget">
                            {{ trans("pages.loyalty_program.exchange_points") }}
                        </salla-button>
                    </salla-loyalty>
                </div>
            </div>
            
            <!-- background big stars -->
            <div class="loyalty-star loyalty-star--first">
              <i class="sicon-star2"></i>
            </div>
            
            <div class="loyalty-star loyalty-star--second">
              <i class="sicon-star2"></i>
            </div>
        </div>

        <!-- ways to get points -->
        <section class="points-ways py-6">
            <h2 class="s-block__title mb-6 sm:mb-8">{{ trans("pages.loyalty_program.ways_to_get_points") }}</h2>
            <div class="points-ways__list">

            {# {{dd(loyalty.points)}} #}

                {% for point in loyalty.points %}
                    <div class="way-item">
                        <div class="flex rtl:space-x-reverse space-x-4">
                            <span class="way-item__icon {{ point.icon ?:'sicon-star' }}" style="color: {{ point.color }}">
                              <span style="background-color: {{ point.color }}"></span>
                            </span>
                            <div class="way-item__content">
                                <h4 style="color: {{ point.color }}">
                                    {{ point.points }}
                                    {{ trans("pages.loyalty_program.point") }}
                                </h4>
                                <p>{{ point.description }}</p>
                            </div>
                        </div>

                        {% if user.type == 'user' %}
                            <div class="point-entry__desc mt-auto">
                                {% if point.type == 'share' %}
                                    <div class="border relative border-gray-600 rounded-3xl bg-white h-[34px] text-center ltr:pl-14 ltr:pr-5 rtl:pr-14 rtl:pl-5">
                                        <salla-button 
                                          onclick="theme.copyToClipboard(event)" 
                                          color="dark"
                                          shape="link"
                                          data-content="{{ point.target_url }}"
                                          class="absolute w-12 top-0 right-0 h-full px-3 !pt-1 ltr:border-r rtl:border-l border-gray-600 hover:opacity-80"
                                          title="{{ trans('pages.loyalty_program.copy_link') }}">
                                            <i class="copy-icon sicon-swap-fill"></i>
                                        </salla-button>

                                        <h3 id="textId"
                                            class="font-bold text-sm leading-8 whitespace-nowrap text-ellipsis overflow-hidden">
                                            {{ point.target_url }}
                                        </h3>
                                    </div>
                                {% elseif point.key == 'COMPLETE_PERSONAL_INFORMATION' and point.is_completed %}
                                    <span class="" disabled>
                                        <i class="sicon-check-circle d-inline-block ty-2d"></i>
                                        {{ trans('pages.loyalty_program.completed') }}
                                    </span>
                                {% else %}
                                    <salla-button 
                                      fill="outline" 
                                      color="dark" 
                                      href="{{ point.target_url }}" 
                                      class="!rounded-3xl text-sm !py-1.5">
                                        {{ point.name }}
                                    </salla-button>
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </section>

        {# 2-block:: prizes #}
        {% for prize in loyalty.prizes %}
            <section id="loyalty-slider-{{ prize.type }}">
                <div class="center-between mb-6 sm:mb-8">
                    {# Block Title #}
                    <h2 class="s-block__title">{{ prize.title }}</h2>

                    {# Slider Nav btns #}
                    <div class="flex items-center">
                        <div class="hidden sm:flex rtl:space-x-reverse space-x-1" dir="rtl">
                            <button aria-label="Previous Slide" class="slider-prev btn--md-arrow">
                                <i class="sicon-keyboard_arrow_right"></i>
                            </button>
                            <button aria-label="Next Slide" class="slider-next btn--md-arrow">
                                <i class="sicon-keyboard_arrow_left"></i>
                            </button>
                        </div>
                    </div>
                </div>

                {# Swiper #}
                <div class="swiper default-slider slider-layout" data-id="loyalty-slider-{{ prize.type }}">
                    <div class="swiper-wrapper flex items-stretch pb-6">
                        {% for prize in prize.items %}
                            <div class="swiper-slide slide--one-fourth">
                                <div class='product-entry flex-col'>
                                    {# use twig to capture image tag instead of repeating our self😉 #}
                                    {% set img %}
                                        <img class="lazy-load sm:h-full w-full object-cover"
                                             src="{{ 'images/s-empty.png' | asset }}"
                                             data-src="{{ prize.image }}"
                                             alt="{{ prize.name }}"/>
                                    {% endset %}
                                    {% if prize.url %}
                                        <a href="{{ prize.url }}" class='product-entry__image h-40'>
                                            {{ img }}
                                        </a>
                                    {% else %}
                                        {{ img }}
                                    {% endif %}
                                    <div class="flex-1 p-5">
                                        <h3 class="product-entry__title leading-6 mb-2.5">
                                            {% if prize.url %}
                                                <a href="{{ prize.url }}">{{ prize.name }}</a>
                                            {% else %}
                                                {{ prize.name }}
                                            {% endif %}
                                        </h3>
                                        <p class="text-sm leading-6 ">{{ prize.description }}</p>
                                    </div>
                                    {% if user.type == 'user' %}
                                        <div class="font-bold text-primary p-4 text-center border-t">
                                            {{ prize.cost_points }}
                                            {{ trans("pages.loyalty_program.point") }}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </section>
        {% endfor %}
    </div>
{% endblock %}

{% block scripts %}
    <script defer src="{{ 'loyalty.js' | asset }}"></script>
{% endblock %}

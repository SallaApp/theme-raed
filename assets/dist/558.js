"use strict";(self.webpackChunkTheme_One=self.webpackChunkTheme_One||[]).push([[558],{8825:(e,t,s)=>{s.d(t,{H:()=>l});class i extends salla.AppHelpers{setHost(e){this.host=e}getElement(e){return this.host.querySelector(e)}getAttribute(e,t){var s;return null===(s=this.getElement(e))||void 0===s?void 0:s.getAttribute(t)}val(e){return this.getAttribute(e,"value")}isUser(){return!!salla.config.is_user}}const l=new i},8558:(e,t,s)=>{s.r(t),s.d(t,{salla_verify:()=>r});var i=s(4634),l=s(8825);const r=class{constructor(e){(0,i.r)(this,e),l.H.setHost(this.host),salla.event.on("profile::verify.mobile",(e=>this.show(e)))}show({international_mobile:e,_country_iso2:t}){return this.mobile=e,this.country_code=t,this.resendTimer(),this.otpInputs=document.querySelectorAll(".s-verify-input"),this.otpInputs[0].focus(),l.H.onKeyUp(".s-verify-input",(e=>{var t,s,i,l;let r=e.keyCode||e.charCode;salla.helpers.digitsOnly(e.target),e.target.value?(null===(t=e.target.nextElementSibling)||void 0===t||t.focus(),null===(s=e.target.nextElementSibling)||void 0===s||s.select()):[8,46].includes(r)&&(null===(i=e.target.previousElementSibling)||void 0===i||i.focus(),null===(l=e.target.previousElementSibling)||void 0===l||l.select()),this.toggleOTPSubmit()})),l.H.on("paste",".s-verify-input",(e=>{let t=e.clipboardData.getData("text").toArabicDigits().replace(/[^0-9.]/g,"").replace("..",".");this.otpInputs.forEach(((e,s)=>e.value=t[s]||"")),this.toggleOTPSubmit(),setTimeout((()=>this.otpInputs[3].focus()),100)})),this.modal.show()}toggleOTPSubmit(){let e=[];if(this.otpInputs.forEach((t=>t.value&&e.push(t.value))),this.code.value=e.join(""),4===e.length)return this.btn.removeAttribute("disabled"),void this.btn.click();this.btn.setAttribute("disabled","")}resendTimer(){l.H.showElement(this.resendMessage).hideElement(this.resend);let e=30,t=setInterval((()=>{-1===e?(clearTimeout(t),l.H.hideElement(this.resendMessage).showElement(this.resend)):(this.timer.innerHTML=`${e>=10?e:"0"+e} : 00`,e--)}),1e3)}submit(){return this.btn.load().then((()=>this.btn.disable())).then((()=>salla.document.api.request("profile/verify-mobile",{mobile:this.mobile,country_code:this.country_code,code:this.code.value}))).then((()=>this.btn.stop()&&this.btn.disable())).then((()=>this.modal.hide())).then((()=>window.location.reload())).catch((()=>this.btn.stop()&&this.btn.enable()))}resendCode(){return this.btn.stop().then((()=>this.btn.disable())).then((()=>{this.otpInputs.forEach((e=>e.value="")),this.otpInputs[0].focus()})).then((()=>salla.api.auth.resend({phone:this.mobile,country_code:this.country_code}))).then((()=>this.resendTimer())).catch((()=>this.resendTimer()))}render(){return(0,i.h)("salla-modal",{id:"s-verify",ref:e=>this.modal=e,title:salla.lang.get("pages.profile.verify_title")},(0,i.h)("div",{class:"s-verify-message",innerHTML:salla.lang.get("pages.profile.verify_message")}),(0,i.h)("label",{class:"s-verify-label"},salla.lang.get("pages.profile.verify_placeholder")),(0,i.h)("input",{type:"hidden",name:"code",maxlength:"4",required:!0,ref:e=>this.code=e}),(0,i.h)("div",{class:"s-verify-codes",dir:"ltr"},[1,2,3,4].map((()=>(0,i.h)("input",{type:"text",maxlength:"1",class:"s-verify-input",required:!0})))),(0,i.h)("div",{slot:"footer",class:"s-verify-footer"},(0,i.h)("salla-button",{class:"s-verify-submit",disabled:!0,onClick:()=>this.submit(),ref:e=>this.btn=e},salla.lang.get("pages.profile.verify")),(0,i.h)("p",{class:"s-verify-resend-message",ref:e=>this.resendMessage=e},salla.lang.get("blocks.header.resend_after"),(0,i.h)("b",{class:"s-verify-timer",ref:e=>this.timer=e})),(0,i.h)("a",{href:"#",class:"s-verify-resend",onClick:()=>this.resendCode(),ref:e=>this.resend=e},salla.lang.get("blocks.comments.submit"))))}get host(){return(0,i.g)(this)}}}}]);
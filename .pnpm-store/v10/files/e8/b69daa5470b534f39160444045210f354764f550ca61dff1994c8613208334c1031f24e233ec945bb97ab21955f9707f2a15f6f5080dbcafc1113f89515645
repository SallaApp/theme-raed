/*!
 * FilePondPluginFilePoster 2.5.2
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */

/* eslint-disable */

const e={type:"spring",stiffness:.5,damping:.45,mass:10},t=(e,t,r=1,o=(e=>-.5*(Math.cos(Math.PI*e)-1)),i=10,a=0)=>{const l=1-a,s=t.join(",");for(let t=0;t<=i;t++){const n=t/i,E=a+l*n;e.addColorStop(E,`rgba(${s}, ${o(n)*r})`)}},r=e=>{const t=Math.min(10/e.width,10/e.height),r=document.createElement("canvas"),i=r.getContext("2d"),a=r.width=Math.ceil(e.width*t),l=r.height=Math.ceil(e.height*t);i.drawImage(e,0,0,a,l);let s=null;try{s=i.getImageData(0,0,a,l).data}catch(e){return null}const n=s.length;let E=0,c=0,d=0,_=0;for(;_<n;_+=4)E+=s[_]*s[_],c+=s[_+1]*s[_+1],d+=s[_+2]*s[_+2];return{r:E=o(E,n),g:c=o(c,n),b:d=o(d,n)}},o=(e,t)=>Math.floor(Math.sqrt(e/(t/4))),i=(e,r,o,i,a)=>{e.width=r,e.height=o;const l=e.getContext("2d"),s=.5*r,n=l.createRadialGradient(s,o+110,o-100,s,o+110,o+100);t(n,i,a,void 0,8,.4),l.save(),l.translate(.5*-r,0),l.scale(2,1),l.fillStyle=n,l.fillRect(0,0,r,o),l.restore()},a="undefined"!=typeof navigator,l="undefined"!=typeof document,s=a&&l&&document.createElement("canvas"),n=a&&l&&document.createElement("canvas"),E=a&&l&&document.createElement("canvas");let c=[40,40,40],d=[196,78,71],_=[54,151,99];a&&l&&(i(s,500,200,c,.85),i(n,500,200,d,1),i(E,500,200,_,1));const I=t=>{const o=(e=>e.utils.createView({name:"file-poster-overlay",tag:"canvas",ignoreRect:!0,create:({root:e,props:t})=>{((e,t)=>{t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0)})(t.template,e.element)},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}}))(t),a=({root:e})=>{e.ref.overlayShadow.opacity=1,e.ref.overlayError.opacity=0,e.ref.overlaySuccess.opacity=0},l=({root:e})=>{e.ref.overlayShadow.opacity=.25,e.ref.overlayError.opacity=1};return t.utils.createView({name:"file-poster-wrapper",create:({root:r,props:a})=>{const l=r.query("GET_FILE_POSTER_ITEM_OVERLAY_SHADOW_COLOR"),I=r.query("GET_FILE_POSTER_ITEM_OVERLAY_ERROR_COLOR"),p=r.query("GET_FILE_POSTER_ITEM_OVERLAY_SUCCESS_COLOR");l&&l!==c&&i(s,500,200,c=l,.85),I&&I!==d&&i(n,500,200,d=I,1),p&&p!==_&&i(E,500,200,_=p,1);const h=(t=>t.utils.createView({name:"file-poster",tag:"div",ignoreRect:!0,create:({root:e})=>{e.ref.image=document.createElement("img"),e.element.appendChild(e.ref.image)},write:t.utils.createRoute({DID_FILE_POSTER_LOAD:({root:e,props:t})=>{const{id:r}=t,o=e.query("GET_ITEM",{id:t.id});if(!o)return;const i=o.getMetadata("poster");e.ref.image.src=i,e.dispatch("DID_FILE_POSTER_DRAW",{id:r})}}),mixins:{styles:["scaleX","scaleY","opacity"],animations:{scaleX:e,scaleY:e,opacity:{type:"tween",duration:750}}}}))(t);r.ref.image=r.appendChildView(r.createChildView(h,{id:a.id,scaleX:1.25,scaleY:1.25,opacity:0})),r.ref.overlayShadow=r.appendChildView(r.createChildView(o,{template:s,opacity:0})),r.ref.overlaySuccess=r.appendChildView(r.createChildView(o,{template:E,opacity:0})),r.ref.overlayError=r.appendChildView(r.createChildView(o,{template:n,opacity:0}))},write:t.utils.createRoute({DID_FILE_POSTER_LOAD:({root:e})=>{e.ref.overlayShadow.opacity=1},DID_FILE_POSTER_DRAW:({root:e})=>{const{image:t}=e.ref;t.scaleX=1,t.scaleY=1,t.opacity=1},DID_FILE_POSTER_CONTAINER_CREATE:({root:e,props:t})=>{const{id:o}=t,i=e.query("GET_ITEM",o);if(!i)return;const a=i.getMetadata("poster"),l=t=>{const a=e.query("GET_FILE_POSTER_CALCULATE_AVERAGE_IMAGE_COLOR")?r(t):null;i.setMetadata("color",a,!0),e.dispatch("DID_FILE_POSTER_LOAD",{id:o,data:t})};((e,t)=>{let r=new Image;r.onload=(()=>{const e=r.naturalWidth,o=r.naturalHeight;r=null,t(e,o)}),r.src=e})(a,(t,r)=>{e.dispatch("DID_FILE_POSTER_CALCULATE_SIZE",{id:o,width:t,height:r}),((e,t)=>new Promise((r,o)=>{const i=new Image;"string"==typeof crossOrigin&&(i.crossOrigin=t),i.onload=(()=>{r(i)}),i.onerror=(e=>{o(e)}),i.src=e}))(a,e.query("GET_FILE_POSTER_CROSS_ORIGIN_ATTRIBUTE_VALUE")).then(l)})},DID_THROW_ITEM_LOAD_ERROR:l,DID_THROW_ITEM_PROCESSING_ERROR:l,DID_THROW_ITEM_INVALID:l,DID_COMPLETE_ITEM_PROCESSING:({root:e})=>{e.ref.overlayShadow.opacity=.25,e.ref.overlaySuccess.opacity=1},DID_START_ITEM_PROCESSING:a,DID_REVERT_ITEM_PROCESSING:a})})},p=e=>{const{addFilter:t,utils:r}=e,{Type:o,createRoute:i}=r,a=I(e);return t("CREATE_VIEW",e=>{const{is:t,view:r,query:o}=e;if(!t("file")||!o("GET_ALLOW_FILE_POSTER"))return;const l=(e,t)=>{const{id:i}=t,l=o("GET_ITEM",i);l&&l.getMetadata("poster")&&!l.archived&&e.ref.previousPoster!==l.getMetadata("poster")&&(e.ref.previousPoster=l.getMetadata("poster"),o("GET_FILE_POSTER_FILTER_ITEM")(l)&&(e.ref.filePoster&&r.removeChildView(e.ref.filePoster),e.ref.filePoster=r.appendChildView(r.createChildView(a,{id:i})),e.dispatch("DID_FILE_POSTER_CONTAINER_CREATE",{id:i})))},s=({root:e})=>{let t=e.query("GET_FILE_POSTER_HEIGHT");if(t)return t;const r=e.query("GET_FILE_POSTER_MIN_HEIGHT"),o=e.query("GET_FILE_POSTER_MAX_HEIGHT");if(r&&e.ref.imageHeight<r)return r;let i=e.rect.element.width*(e.ref.imageHeight/e.ref.imageWidth);return r&&i<r?r:o&&i>o?o:i};r.registerWriter(i({DID_LOAD_ITEM:({root:e,props:t})=>{l(e,t)},DID_FILE_POSTER_CALCULATE_SIZE:({root:e,action:t})=>{e.ref.filePoster&&(e.ref.imageWidth=t.width,e.ref.imageHeight=t.height,e.ref.shouldUpdatePanelHeight=!0,e.dispatch("KICK"))},DID_UPDATE_ITEM_METADATA:({root:e,props:t,action:r})=>{/poster/.test(r.change.key)&&l(e,t)}},({root:e,props:t})=>{e.ref.filePoster&&(e.rect.element.hidden||e.ref.shouldUpdatePanelHeight&&(e.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:t.id,height:s({root:e})}),e.ref.shouldUpdatePanelHeight=!1))}))}),{options:{allowFilePoster:[!0,o.BOOLEAN],filePosterHeight:[null,o.INT],filePosterMinHeight:[null,o.INT],filePosterMaxHeight:[null,o.INT],filePosterFilterItem:[()=>!0,o.FUNCTION],filePosterCalculateAverageImageColor:[!1,o.BOOLEAN],filePosterCrossOriginAttributeValue:["Anonymous",o.STRING],filePosterItemOverlayShadowColor:[null,o.ARRAY],filePosterItemOverlayErrorColor:[null,o.ARRAY],filePosterItemOverlaySuccessColor:[null,o.ARRAY]}}};"undefined"!=typeof window&&void 0!==window.document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:p}));export default p;

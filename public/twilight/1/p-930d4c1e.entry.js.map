{"version":3,"names":["sallaProductsListCss","SallaProductsList","constructor","hostRef","salla","lang","get","config","onLoaded","this","placeholderText","endOfText","failedLoadMore","connectedCallback","event","on","filters","setFilters","JSON","stringify","parsedFilters","window","scrollTo","top","behavior","parse","currentPage","slug","category_id","currentCategoryIdFilter","reload","autoload","loadMoreWrapper","style","display","hasInfiniteScroll","infiniteScroll","destroy","buildNextPageUrl","wrapper","innerHTML","init","getInitialData","showPlaceholder","placeholderLoader","document","createElement","classList","add","host","insertAdjacentElement","isFilterable","filtersResults","isSourceWithoutValue","includes","getSource","animateItems","anime","targets","opacity","duration","translateY","delay","_el","i","initBaseNextPageUrl","source","nextPage","url","api","limit","sortBy","key","value","Object","entries","encodeURIComponent","Array","isArray","forEach","item","k","v","getSourceValue","join","e","logger","warn","sourceValueIsValid","loading","isLoading","isBtn","btnLoader","loader","currentLoader","getItemHTML","product","customComponentTag","hasCustomComponent","productCardComponent","productCard","applyLandingPageStyles","applyHorizontalCardStyles","toggleAttribute","horizontalCards","setAttribute","Helper","getProductsSource","getProductsSourceValue","sourceValue","appendDataLayer","data","scriptElement","dataLayer","ecommerce","currencyCode","impressions","map","id","name","price","brand","quantity","variant","categories","category","page","pageName","mobileApp","referrer","theme","appendChild","createTextNode","head","initiateInfiniteScroll","initiate","path","history","scrollThreshold","loadOnScroll","_a","_b","response","length","pageIndex","remove","appendItems","handleResponse","_c","status","querySelector","onReady","loadNextPage","loadMore","componentWillLoad","onSallaReadyPromise","customElements","searchParams","URLSearchParams","location","search","extractFiltersFromUrl","message","isReady","setTimeout","append","fetchProducts","then","res","card","canRender","render","h","class","ShoppingBag","Host","ref","onClick","loadMoreText","componentDidLoad","title","cursor","current","getPageTitleForSource","word","catId","_d","find","filter","values","cat","choice","_e","replace","emit","productsFetched","next","option","_f"],"sources":["src/components/salla-products-list/salla-products-list.scss?tag=salla-products-list","src/components/salla-products-list/salla-products-list.tsx"],"sourcesContent":["\n","import { Component, Host, h, Prop, State, Element, Method, Event, EventEmitter } from '@stencil/core';\nimport anime from 'animejs';\nimport ShoppingBag from '../../assets/svg/shopping-bag.svg';\nimport Helper from '../../Helpers/Helper';\n@Component({\n  tag: 'salla-products-list',\n  styleUrl: 'salla-products-list.scss'\n})\nexport class SallaProductsList {\n  constructor() {\n    salla.lang.onLoaded(() => {\n      this.placeholderText = salla.lang.get('pages.categories.no_products');\n      this.endOfText = salla.lang.get('common.elements.end_of_content');\n      this.failedLoadMore = salla.lang.get('common.elements.failed_to_load_more');\n    })\n  }\n  connectedCallback() {\n    salla.event.on('salla-filters::changed', filters => this.setFilters(filters))\n  }\n\n  /**\n   * Set parsed filters data from URI\n   * @param filters\n   */\n  @Method()\n  async setFilters(filters) {\n    if (!filters || JSON.stringify(filters) === JSON.stringify(this.parsedFilters)) {\n      return;\n    }\n    window.scrollTo({ top: 0, behavior: 'smooth' });\n    // Create a deep copy of the filters object to avoid mutating the original object\n    this.parsedFilters = JSON.parse(JSON.stringify(filters));\n    if (this.currentPage.slug == \"product.index\" && this.parsedFilters && this.parsedFilters.category_id) {\n      this.currentCategoryIdFilter = [this.parsedFilters.category_id]\n    }\n    return this.reload();\n  }\n\n  /**\n   * Reload the list of products (entire content of the component).\n   */\n  @Method()\n  async reload() {\n    !this.autoload && this.loadMoreWrapper && (this.loadMoreWrapper.style.display = 'none');\n    this.hasInfiniteScroll && salla.infiniteScroll.destroy(this.infiniteScroll);\n    this.buildNextPageUrl();\n    // TODO: this is problematic in testing, for the time being it's been resolved like this\n    this.wrapper.innerHTML = '';\n    if (this.hasInfiniteScroll) {\n      this.init();\n    } else {\n      this.getInitialData();\n    }\n    // Special case for the placeholder loader\n    if (this.showPlaceholder) {\n      this.showPlaceholder = false;\n      this.placeholderLoader = document.createElement('div');\n      this.placeholderLoader.classList.add('s-products-list-loading-wrapper');\n      this.placeholderLoader.style.display = 'inherit';\n      this.placeholderLoader.innerHTML = `<span class=\"s-button-loader s-button-loader-center s-infinite-scroll-btn-loader\"></span>`;\n      this.host.insertAdjacentElement('afterend', this.placeholderLoader);\n    }\n  }\n\n\n  private status: HTMLDivElement;\n  private btnLoader: HTMLElement;\n  private loader: HTMLElement;\n  private placeholderLoader: HTMLElement;\n  private loadMoreWrapper: HTMLElement;\n  @Element() host: HTMLElement;\n  private wrapper: any;\n  private infiniteScroll: any;\n  /**\n   * The source of the products list\n   * @type {string}\n   * */\n  @Prop({\n    reflect: true,\n    mutable: true\n  }) source: 'categories' | 'latest' | 'related' | 'brands' | 'json' | 'search' | 'tags' | 'selected' | 'offers' | 'landing-page' | 'sales' | 'wishlist';\n\n  /**\n   * The source value, cloud be different values as following:\n   * - array of ids when `source` in ['categories', 'brands', 'tags', 'selected']\n   * - keyword when `source` = 'search'\n   * - products payload when `source` = 'json'\n   * - product_id when `source` = 'related'\n   *\n   * @type {string}\n   * */\n  @Prop({ mutable: true }) sourceValue: any;\n\n  /**\n   * Limit for number of products in the list.\n   */\n  @Prop({ mutable: true }) limit: number;\n\n  /**\n   * Sorting the list of products\n   */\n  @Prop({ mutable: true }) sortBy?: string | 'ourSuggest' | 'bestSell' | 'topRated' | 'priceFromTopToLow' | 'priceFromLowToTop';\n\n  /**\n   * should listen to filters events `salla-filters::changed` and re-render\n   */\n  @Prop({ reflect: true, mutable: true }) filtersResults: boolean;\n\n  /**\n   * Horizontal cards\n   */\n  @Prop({ reflect: true }) horizontalCards: boolean\n\n  /**\n   * Autoload next page when scroll\n   */\n  @Prop({ mutable: true }) autoload: boolean = false;\n\n  /**\n * Load more text\n */\n  @Prop() loadMoreText: string;\n\n  /**\n   * Custom Card Component for the Salla Products List.\n   *\n   * This component allows you to customize the appearance of individual product cards within a Salla Products List.\n   *\n   * @example\n   * <salla-products-list product-card-component=\"my-custom-card-style1\" ...\n   * <salla-products-list product-card-component=\"my-custom-card-style2\" ...\n   */\n  @Prop() productCardComponent: string = 'custom-salla-product-card';\n\n  // State\n  @State() page: number = 1;\n  @State() nextPage: string;\n  @State() hasInfiniteScroll: boolean;\n  @State() hasCustomComponent: boolean;\n  @State() sourceValueIsValid: boolean;\n  @State() placeholderText: string = salla.lang.get('pages.categories.no_products');\n  @State() endOfText: string = salla.lang.get('common.elements.end_of_content');\n  @State() failedLoadMore: string = salla.lang.get('common.elements.failed_to_load_more');\n  @State() currentPage: any = salla.config.get('page');\n  @State() currentCategoryIdFilter: any;\n  @State() isReady: boolean;\n  @State() showPlaceholder: boolean;\n  @State() parsedFilters: any;\n\n  /**\n   * Custom event fired when the the products fetched.\n   */\n  @Event() productsFetched: EventEmitter;\n\n  private isFilterable() {\n    return salla.config.get('store.settings.product.filters') && this.filtersResults;\n  }\n\n  private isSourceWithoutValue() {\n    return ['offers', 'latest', 'sales'].includes(this.getSource());\n  }\n\n  private animateItems() {\n    anime({\n      targets: 'salla-products-list salla-product-card',\n      opacity: [0, 1],\n      duration: 1200,\n      translateY: [20, 0],\n      delay: function (_el, i) {\n        return i * 100;\n      },\n    })\n  }\n\n\n  private initBaseNextPageUrl(source: string) {\n\n    this.nextPage = salla.url.api(`products?source=${source}`);\n\n    if (this.limit) {\n      this.nextPage += `&per_page=${this.limit > 32 ? 32 : this.limit}`;\n    }\n    if (this.sortBy) {\n      this.nextPage += `&sort=${this.sortBy}`;\n    }\n    // if (!this.isFilterable()) {\n    //   return this.nextPage;\n    // }\n    this.nextPage += '&filterable=1';\n    for (const [key, value] of Object.entries(this.parsedFilters || {})) {\n      if ([\"string\", \"number\"].includes(typeof value)) {\n        // @ts-ignore\n        this.nextPage += `&filters[${encodeURIComponent(key)}]=${encodeURIComponent(value)}`;\n      } else if (Array.isArray(value)) {\n        value.forEach(item => this.nextPage += `&filters[${encodeURIComponent(key)}][]=${encodeURIComponent(item)}`);\n      } else if (typeof value === 'object') {\n        for (const [k, v] of Object.entries(value)) {\n          this.nextPage += `&filters[${encodeURIComponent(key)}][${encodeURIComponent(k)}]=${encodeURIComponent(v)}`;\n        }\n      }\n    }\n  }\n\n  private buildNextPageUrl() {\n    let source = this.getSource();\n    if (source === 'json') {\n      return;\n    }\n    this.initBaseNextPageUrl(source);\n    if (this.isSourceWithoutValue()) {\n      return;\n    }\n\n    if (['search', 'related', 'landing-page'].includes(source)) {\n      this.nextPage += `&source_value=${this.getSourceValue()}`;\n      return;\n    }\n    try {\n      this.nextPage += `&source_value[]=${this.getSourceValue().join('&source_value[]=')}`;\n    } catch (e) {\n      salla.logger.warn(`source-value prop should be array of ids ex source-value=\"[1,2,3]\" for the source [${source}]`);\n      this.sourceValueIsValid = false;\n    }\n  }\n\n\n  private loading(isLoading = true, isBtn = false) {\n    if (!isLoading) {\n      if (!this.autoload) {\n        this.btnLoader && (this.btnLoader.style.display = 'none');\n      }\n      this.loader && (this.loader.style.display = 'none');\n    } else {\n      let currentLoader = isBtn && !this.autoload ? this.btnLoader : this.loader;\n      currentLoader && (currentLoader.style.display = 'inherit');\n    }\n  }\n\n  private getItemHTML(product) {\n    //as a request they don't want to let the user to open the product details\n    //todo:: find a better way to handle this request\n    this.getSource() === 'landing-page' && (product.url = '');\n    const customComponentTag = this.hasCustomComponent ? this.productCardComponent : 'salla-product-card';\n    const productCard = document.createElement(customComponentTag) as HTMLSallaProductCardElement;\n\n    productCard.product = product;\n\n    this.applyLandingPageStyles(productCard);\n    this.applyHorizontalCardStyles(productCard);\n\n    return productCard;\n  }\n\n  private applyLandingPageStyles(productCard) {\n    if (this.getSource() === 'landing-page' && !this.hasCustomComponent) {\n      productCard.toggleAttribute('hide-add-btn', true);\n      productCard.classList.add('s-product-card-fit-height');\n    }\n  }\n\n  private applyHorizontalCardStyles(productCard) {\n    if (!this.horizontalCards) {\n      return;\n    }\n    productCard.setAttribute('horizontal', true);\n    if (!this.hasCustomComponent) {\n      productCard.setAttribute('shadow-on-hover', true);\n    }\n\n  }\n\n  private getSource() {\n    return Helper.getProductsSource(this.source);\n  }\n\n  private getSourceValue() {\n    return this.currentCategoryIdFilter ? this.currentCategoryIdFilter : Helper.getProductsSourceValue(this.source, this.sourceValue);\n  }\n  //@ts-ignore\n  private appendDataLayer(data) {\n    const scriptElement = document.createElement('script');\n    let dataLayer = {\n      \"event\": \"impressions\",\n      \"ecommerce\": {\n        \"currencyCode\": salla.config.get('user.currency_code'),\n        // \"event_id\":\"\", // todo\n        \"impressions\": data.map((product) => {\n          return {\n            \"id\": product.id,\n            \"name\": product.name,\n            \"price\": product.price,\n            \"brand\": \"\",\n            \"quantity\": product.quantity,\n            \"variant\": \"\",\n            \"categories\": [\n              {\n                \"name\": salla.config.get('page.title'),\n                \"id\": salla.config.get('page.id')\n              }\n            ],\n            \"category\": salla.config.get('page.title')\n          }\n        }),\n        \"page\": {\n          // \"fingerprint\":\"\", // todo\n          \"pageName\": salla.config.get('page.slug'),\n          \"mobileApp\": 0,\n          \"referrer\": document.referrer,\n          \"theme\": salla.config.get('theme.name')\n        },\n      }\n    }\n    scriptElement.appendChild(document.createTextNode('window.dataLayer = window.dataLayer || [];'));\n    scriptElement.appendChild(document.createTextNode('window.dataLayer.push(' + JSON.stringify(dataLayer) + ');'));\n    document.head.appendChild(scriptElement);\n  }\n\n  private initiateInfiniteScroll() {\n    if (!this.hasInfiniteScroll) {\n      return;\n    }\n    this.infiniteScroll = salla.infiniteScroll.initiate(this.wrapper, this.wrapper, {\n      path: () => this.nextPage,\n      history: false,\n      nextPage: this.nextPage,\n      scrollThreshold: this.autoload ? 100 : false,\n      loadOnScroll: this.autoload,\n    }, /* infinite via api*/true);\n    this.infiniteScroll?.on('request', () => {\n      this.loading(true, this.autoload ? false : true);\n    })\n    this.infiniteScroll?.on('load', response => {\n      if (!response.data?.length && this.infiniteScroll.pageIndex == 2) {\n        this.showPlaceholder = true;\n        salla.infiniteScroll.destroy(this.infiniteScroll);\n        this.loading(false);\n        this.placeholderLoader && this.placeholderLoader.remove();\n        return;\n      } else {\n        this.showPlaceholder = false;\n\n      }\n      this.infiniteScroll.appendItems(this.handleResponse(response))\n      if (this.infiniteScroll.pageIndex == 2) {\n        //todo::test it more\n        /*if (['categories', 'brands', 'tags', 'search', 'latest'].includes(this.getSource())) {\n          this.appendDataLayer(response.data);\n        }*/\n        if (!this.autoload && this.nextPage) {\n          this.loadMoreWrapper.style.display = 'block';\n        }\n        this.animateItems();\n      }\n    })\n    this.infiniteScroll?.on('error', () => {\n      this.status.querySelector('.s-infinite-scroll-error').classList.remove('s-hidden')\n      this.placeholderLoader && this.placeholderLoader.remove();\n      this.loading(false);\n    });\n    salla.onReady(() => salla.infiniteScroll.loadNextPage(this.infiniteScroll))\n  }\n  async loadMore() {\n    this.infiniteScroll?.loadNextPage();\n  }\n\n  componentWillLoad() {\n    return Helper.onSallaReadyPromise(() => {\n      this.hasCustomComponent = !!customElements.get(this.productCardComponent);\n      this.sourceValueIsValid = !!(this.getSourceValue() || this.isSourceWithoutValue());\n      this.hasInfiniteScroll = !['json', 'selected', 'related', 'landing-page'].includes(this.getSource()) && !this.limit;\n      let searchParams = new URLSearchParams(window.location.search);\n\n\n      try {\n        this.sortBy = this.sortBy || searchParams.get('sort') || searchParams.get('by');\n\n        this.parsedFilters = Helper.extractFiltersFromUrl(searchParams);\n\n        if (this.parsedFilters && this.parsedFilters.category_id) {\n          this.currentCategoryIdFilter = [this.parsedFilters.category_id];\n        }\n      } catch (e) {\n        salla.logger.warn('failed to get filters from url', e.message);\n      }\n\n\n      this.buildNextPageUrl();\n\n      this.isReady = true;\n\n      if (!this.sourceValueIsValid) {\n        salla.logger.warn(`source-value prop is required for source [${this.getSource()}]`);\n        return;\n      }\n      if (this.hasInfiniteScroll) {\n        return;\n      }\n\n      // Handle json source\n      if (this.getSource() === 'json') {\n        if (!this.getSourceValue().length) {\n          this.showPlaceholder = true;\n          return;\n        }\n        setTimeout(() => {\n          this.getSourceValue().map(product => this.wrapper.append(this.getItemHTML(product)));\n        });\n        return;\n      }\n\n      // Handle selected source\n      if (this.getSource() === 'selected' && !this.getSourceValue().length) {\n        this.showPlaceholder = true;\n        return;\n      }\n\n      return this.getInitialData();\n    });\n  }\n\n  private getInitialData() {\n    this.loading();\n    Helper.fetchProducts(this.getSource(), this.getSourceValue(), this.limit).then(res => {\n      if (!res.data.length) {\n        this.showPlaceholder = true;\n        this.placeholderLoader && this.placeholderLoader.remove();\n        this.loading(false);\n        return;\n      }\n      setTimeout(() => {\n        this.handleResponse(res).forEach(card => this.wrapper.append(card));\n      }, 100);\n    });\n  }\n\n  private canRender() {\n    return this.sourceValueIsValid && this.isReady;\n  }\n\n  render() {\n    if (!this.canRender()) {\n      return '';\n    }\n\n    if (this.showPlaceholder) {\n      return <div class=\"s-products-list-placeholder\">\n        <span innerHTML={ShoppingBag} />\n        <p>{this.placeholderText}</p>\n      </div>\n    }\n    return (\n      <Host class=\"s-products-list\">\n        <div class={{\n          \"s-products-list-wrapper\": true,\n          's-products-list-horizontal-cards': this.horizontalCards && !this.filtersResults,\n          's-products-list-vertical-cards': !this.horizontalCards && !this.filtersResults,\n          's-products-list-filters-results': this.filtersResults,\n        }}\n          ref={wrapper => this.wrapper = wrapper} />\n        <div class=\"s-infinite-scroll-status\" ref={status => this.status = status}>\n          <p class=\"s-infinite-scroll-last infinite-scroll-last s-hidden\" >{this.endOfText}</p>\n          <p class=\"s-infinite-scroll-error infinite-scroll-error s-hidden\">{this.failedLoadMore}</p>\n        </div>\n\n        <div class=\"s-products-list-loading-wrapper\" style={{ \"display\": \"none\" }} ref={loader => this.loader = loader}><span class=\"s-button-loader s-button-loader-center s-infinite-scroll-btn-loader\"></span></div>\n\n        {this.hasInfiniteScroll && this.nextPage && !this.autoload ? (\n          <div class=\"s-infinite-scroll-wrapper\" style={{ \"display\": \"none\" }} ref={loadMoreWrapper => this.loadMoreWrapper = loadMoreWrapper}>\n            <button onClick={() => this.loadMore()} class=\"s-infinite-scroll-btn s-button-btn s-button-primary\">\n              <span class=\"s-button-text s-infinite-scroll-btn-text\">{this.loadMoreText ? this.loadMoreText : salla.lang.get('common.elements.load_more')}</span>\n              <span class=\"s-button-loader s-button-loader-center s-infinite-scroll-btn-loader\" ref={btnLoader => this.btnLoader = btnLoader} style={{ \"display\": \"none\" }}></span>\n            </button>\n          </div>\n        ) : \"\"}\n      </Host>\n    );\n  }\n\n  componentDidLoad() {\n    this.hasInfiniteScroll && this.init();\n  }\n\n  private init() {\n    this.initiateInfiniteScroll();\n    this.loading();\n  }\n\n  private handleResponse(response): Array<HTMLElement> {\n    let source = this.getSource();\n    let title = '';\n    //help the developer to know the current page title\n    if (response.cursor?.current === 1) {\n      title = Helper.getPageTitleForSource(source);\n      try {\n        if (this.getSource() === 'search') {\n          title = salla.lang.get('common.elements.search_about', { 'word': this.getSourceValue() });\n        } else if (!title) {\n          let catId = this.parsedFilters.category_id || this.getSourceValue()[0];\n          // get the first filter that its key is category_id, then get the value when filter.value.*.key==catId\n          title = response.filters.find(filter => filter.key == 'category_id')?.values?.find(cat => cat.key == catId)?.value || '';\n        }\n        title += (title ? ' - ' : '') + salla.lang.choice('blocks.header.products_count', response.data?.length);\n        if (response.data.length === 15) {\n          title = title.replace(response.data.length, salla.lang.get('common.elements.more_than') + ' ' + response.data.length)\n        }\n        response.title = title;\n      } catch (e) { }\n    }\n\n    salla.event.emit('salla-products-list::products.fetched', response);\n    this.productsFetched.emit(response);\n    //ðŸ’¡ when source is related, cursor will not be existed\n    if (response.filters && this.isFilterable()) {\n      this.filtersResults = true;\n      salla.event.emit('filters::fetched', { filters: response.filters });\n    } else if (this.isFilterable()) {\n      salla.event.emit('filters::hidden');\n    }\n    this.nextPage = response.cursor ? response.cursor.next : this.nextPage;\n    this.loading(false);\n    this.placeholderLoader && this.placeholderLoader.remove();\n    if (this.hasInfiniteScroll && !this.nextPage) {\n      this.infiniteScroll.option({ scrollThreshold: false, loadOnScroll: false });\n      this.status.querySelector('.s-infinite-scroll-last').classList.remove('s-hidden');\n    }\n    return response.data?.map(product => this.getItemHTML(product)) || [];\n  }\n}\n"],"mappings":"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"}
(()=>{"use strict";function n(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},e(n)}function t(n){var t=function(n){if("object"!=e(n)||!n)return n;var t=n[Symbol.toPrimitive];if(void 0!==t){var r=t.call(n,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==e(t)?t:t+""}function r(n,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,t(o.key),o)}}function o(n){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},o(n)}function i(n,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,e){return n.__proto__=e,n},i(n,e)}function c(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(n){}return(c=function(){return!!n})()}function a(n){var e="function"==typeof Map?new Map:void 0;return a=function(n){if(null===n||!function(n){try{return-1!==Function.toString.call(n).indexOf("[native code]")}catch(e){return"function"==typeof n}}(n))return n;if("function"!=typeof n)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(n))return e.get(n);e.set(n,t)}function t(){return function(n,e,t){if(c())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var o=new(n.bind.apply(n,r));return t&&i(o,t.prototype),o}(n,arguments,o(this).constructor)}return t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,n)},a(n)}function l(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(n){}return(l=function(){return!!n})()}var u=function(t){function c(){return function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),n=this,r=arguments,t=o(t=c),function(n,t){if(t&&("object"==e(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}(n)}(n,l()?Reflect.construct(t,r||[],o(n).constructor):t.apply(n,r));var n,t,r}return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&i(n,e)}(c,t),a=c,u=[{key:"connectedCallback",value:function(){var n=this;salla.onReady().then(function(){return salla.lang.onLoaded()}).then(function(){return n.menus=[],n.displayAllText=salla.lang.get("blocks.home.display_all"),n.moreText=salla.lang.get("common.titles.more"),n.visibleMenus=[],n.overflowMenus=[],salla.api.component.getMenus().then(function(e){var t=e.data;return n.menus=t,n.render()}).then(function(){n.initializeResponsiveMenu()}).catch(function(n){return salla.logger.error("salla-menu::Error fetching menus",n)})})}},{key:"hasChildren",value:function(n){var e;return(null==n||null===(e=n.children)||void 0===e?void 0:e.length)>0}},{key:"hasProducts",value:function(n){var e;return(null==n||null===(e=n.products)||void 0===e?void 0:e.length)>0}},{key:"getDesktopClasses",value:function(n,e){return"!hidden lg:!block ".concat(e?"root-level lg:!inline-block":"relative"," ").concat(n.products?" mega-menu":"","\n        ").concat(this.hasChildren(n)?" has-children":"")}},{key:"getMobileMenu",value:function(n,e){var t=this,r=n.image?'<img src="'.concat(n.image,'" class="rounded-full" width="48" height="48" alt="').concat(n.title,'" />'):"";return'\n        <li class="lg:hidden text-sm font-bold" '.concat(n.attrs,">\n            ").concat(this.hasChildren(n)?'\n                <span class="'.concat(n.image?"!py-3":"",'">\n                    ').concat(r,"\n                    ").concat(n.title,'\n                </span>\n                <ul>\n                    <li class="text-sm font-bold">\n                        <a href="').concat(n.url,'" class="text-gray-500">').concat(e,"</a>\n                    </li>\n                    ").concat(n.children.map(function(n){return t.getMobileMenu(n,e)}).join(""),"\n                </ul>\n            "):'\n                <a href="'.concat(n.url,'" aria-label="').concat(n.title||"category",'" class="text-gray-500 ').concat(n.image?"!py-3":"",'" ').concat(n.link_attrs,">\n                    ").concat(r,"\n                    <span>").concat(n.title||"","</span>\n                </a>"),"\n        </li>")}},{key:"getDesktopMenu",value:function(n,e){var t=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return'\n        <li class="'.concat(this.getDesktopClasses(n,e)," ").concat(r,'" ').concat(n.attrs,' data-menu-item>\n            <a href="').concat(n.url,'" aria-label="').concat(n.title||"category",'" ').concat(n.link_attrs,">\n                <span>").concat(n.title,"</span>\n            </a>\n            ").concat(this.hasChildren(n)?'\n                <div class="sub-menu '.concat(this.hasProducts(n)?"w-full left-0 flex":"w-56",'">\n                    <ul class="').concat(this.hasProducts(n)?"w-56 shrink-0 m-8 rtl:ml-0 ltr:mr-0":"",'">\n                        ').concat(n.children.map(function(n){return t.getDesktopMenu(n,!1)}).join("\n"),"\n                    </ul>\n                    ").concat(this.hasProducts(n)?'\n                    <salla-products-list\n                    source="selected"\n                    shadow-on-hover\n                    source-value="['.concat(n.products,']" />'):"","\n                </div>"):"","\n        </li>")}},{key:"getMenus",value:function(){var n=this;return this.menus.map(function(e){return"\n            ".concat(n.getMobileMenu(e,n.displayAllText),"\n            ").concat(n.getDesktopMenu(e,!0),"\n        ")}).join("\n")}},{key:"createMoreDropdown",value:function(){var n=this;return 0===this.overflowMenus.length?"":'\n        <li class="!hidden lg:!block root-level lg:!inline-block has-children relative" id="more-menu-dropdown">\n            <a href="#" aria-label="'.concat(this.moreText,'">\n                <span>').concat(this.moreText,'</span>\n            </a>\n            <div class="sub-menu w-56">\n                <ul>\n                    ').concat(this.overflowMenus.map(function(e){return n.getDesktopMenu(e,!1)}).join("\n"),"\n                </ul>\n            </div>\n        </li>")}},{key:"initializeResponsiveMenu",value:function(){var n=this;if(!(window.innerWidth<1024)&&this.querySelector(".main-menu")&&window.enable_more_menu){this.checkMenuOverflow();var e=this.debounce(function(){n.checkMenuOverflow()},250);window.addEventListener("resize",e)}}},{key:"checkMenuOverflow",value:function(){var e=this,t=this.querySelector(".main-menu");if(t){var r=t.closest(".container");if(r){this.visibleMenus=function(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(e)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this.menus),this.overflowMenus=[];var o=t.querySelector("#more-menu-dropdown");o&&o.remove();var i=t.querySelectorAll(".root-level[data-menu-item]");i.forEach(function(n){n.style.display=""});var c=r.offsetWidth,a=r.querySelector(".flex").children,l=0;Array.from(a).forEach(function(n){n.contains(t)||(l+=n.offsetWidth)});var u=c-l-300,s=0,f=0;i.forEach(function(n,t){var r=n.offsetWidth;s+r<=u&&t<e.menus.length?(s+=r,f++):(n.style.setProperty("display","none","important"),t<e.menus.length&&e.overflowMenus.push(e.menus[t]))}),this.visibleMenus=this.menus.slice(0,f),this.overflowMenus.length>0&&t.insertAdjacentHTML("beforeend",this.createMoreDropdown())}}}},{key:"debounce",value:function(n,e){var t;return function(){for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];clearTimeout(t),t=setTimeout(function(){clearTimeout(t),n.apply(void 0,o)},e)}}},{key:"render",value:function(){this.innerHTML='\n        <nav id="mobile-menu" class="mobile-menu">\n            <ul class="main-menu">'.concat(this.getMenus(),'</ul>\n            <button class="btn--close close-mobile-menu sicon-cancel lg:hidden"></button>\n        </nav>\n        <button class="btn--close-sm close-mobile-menu sicon-cancel hidden"></button>')}}],u&&r(a.prototype,u),Object.defineProperty(a,"prototype",{writable:!1}),a;var a,u}(a(HTMLElement));customElements.define("custom-main-menu",u)})();